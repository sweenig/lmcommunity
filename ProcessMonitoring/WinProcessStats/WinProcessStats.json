{
  "id" : 13504265,
  "description" : "Monitor the resource usage of a process.",
  "group" : "_WeenigWare Community",
  "appliesTo" : "isWindows()",
  "technology" : "#04/16/2020\nDatasource created with the intent of don't perform a WMI query for each process instance (this will reduce the collector usage)",
  "tags" : "",
  "checksum" : "9e27bba13c337d6bbb84382ade8b9bca",
  "lineageId" : "LbJuydTOSTK0vcttdXskrg",
  "name" : "WinProcessStats",
  "displayName" : "Processes",
  "version" : 1587075252,
  "auditVersion" : 0,
  "hasMultiInstances" : true,
  "collectInterval" : 180,
  "collectMethod" : "batchscript",
  "collectorAttribute" : {
    "name" : "batchscript",
    "linuxCmdline" : "",
    "linuxScript" : "",
    "groovyScript" : "import com.santaba.agent.groovyapi.win32.WMI;\n\ndef host = hostProps.get(\"system.hostname\");\ndef process_name = [];\ndef process_percentprocessortime = [];\ndef process_handlecount = [];\ndef process_iodatabytespersec = [];\ndef process_processid = [];\ndef process_threadcount = [];\ndef process_workingset = [];\n\n// get the processes list\ndef process_list = WMI.queryAll(host, \"select * from Win32_PerfRawData_PerfProc_Process\");\n\n// enumerate as a map\nprocess_list.each\n{ process_map ->\n    // enumerate each of the fields in this process map\n    process_map.each\n    { key,value ->\n        //grab the name\n        if ((key == \"NAME\") )\n        {\n            //add the process name into the 'svc' list\n            process_name.add(value) \n        }\n        //grab the HandleCount\n        if ((key == \"HANDLECOUNT\") )\n        {\n            //add the process name into the 'svc' list\n            process_handlecount.add(value) \n        }\n        //grab the IODataBytesPerSec\n        if ((key == \"IODATABYTESPERSEC\") )\n        {\n            //add the process name into the 'svc' list\n            process_iodatabytespersec.add(value) \n        }\n        //grab the PercentProcessorTime\n        if ((key == \"PERCENTPROCESSORTIME\") )\n        {\n            //add the process name into the 'svc' list\n            process_percentprocessortime.add(value) \n        }\n        //grab the ProcessID\n        if ((key == \"IDPROCESS\") )\n        {\n            //add the process name into the 'svc' list\n            process_processid.add(value) \n        }\n        //grab the ThreadCount\n        if ((key == \"THREADCOUNT\") )\n        {\n            //add the process name into the 'svc' list\n            process_threadcount.add(value) \n        }\n        //grab the WorkingSet\n        if ((key == \"WORKINGSET\") )\n        {\n            //add the process name into the 'svc' list\n            process_workingset.add(value) \n        }\n    } \n}\n\n//iterate to the built list 'process_name' & extract values to build the output line(s)\nprocess_name.eachWithIndex { item, index ->\n    //check for SpecialCharacters & remove them\n    item2=SpecialCharacterCheck(item)\n\n    println item2+\".HandleCount=\"+process_handlecount[index]\n    println item2+\".IODataBytesPerSec=\"+process_iodatabytespersec[index]\n    println item2+\".PercentProcessorTime=\"+process_percentprocessortime[index]\n    println item2+\".ProcessID=\"+process_processid[index]\n    println item2+\".ThreadCount=\"+process_threadcount[index]\n    println item2+\".WorkingSet=\"+process_workingset[index]\n}\n\nreturn(0);\n\n//according to :\n//https://www.logicmonitor.com/support/logicmodules/datasources/active-discovery/script-active-discovery\n//active discovery WILDVALUE cannot contain  ['=',':','\\','#','space'] characters\n//the function below will get rid of those special characters if they exist\ndef SpecialCharacterCheck(process){\n\t//special characters not allowed in ActiveDiscovery\n\tdef specialCharacters = ~/\\=|\\:|\\\\|\\#|\\s/\n\n\t//replace the special character by nothing & return the 'new' process name\n\tprocess=process.replaceAll(specialCharacters, '')\n\t//println(process); //DEBUG\n\n\treturn process\n}",
    "scriptType" : "embed",
    "windowsCmdline" : "",
    "windowsScript" : ""
  },
  "enableAutoDiscovery" : true,
  "autoDiscoveryConfig" : {
    "persistentInstance" : false,
    "disableInstance" : false,
    "deleteInactiveInstance" : true,
    "instanceAutoGroupMethod" : "none",
    "instanceAutoGroupMethodParams" : "",
    "scheduleInterval" : 0,
    "method" : {
      "name" : "ad_script",
      "type" : "embeded",
      "winScript" : null,
      "winCmdline" : null,
      "linuxCmdline" : null,
      "linuxScript" : null,
      "groovyScript" : "import com.santaba.agent.groovyapi.win32.WMI;\n\ndef host = hostProps.get(\"system.hostname\");\ndef process_name = [];\n\n// get the process list\ndef process_list = WMI.queryAll(host, \"select * from Win32_PerfRawData_PerfProc_Process\");\n\n// enumerate as a map\nprocess_list.each\n{ process_map ->\n    // enumerate each of the fields in this process map\n    process_map.each\n    { key,value ->\n        //grab the name\n        if ((key == \"NAME\") )\n        {\n            //feed the svc list\n            process_name.add(value)\n        }\n    } \n}\n\n//iterate to the built list 'process_name' & extract values to build the output line(s)\nprocess_name.eachWithIndex { item, index ->\n    //check for SpecialCharacters & remove them\n    item2=SpecialCharacterCheck(item)\n    \n    println item2+\"##\"+item;\n}\n\nreturn(0);\n\n//according to :\n//https://www.logicmonitor.com/support/logicmodules/datasources/active-discovery/script-active-discovery\n//active discovery WILDVALUE cannot contain  ['=',':','\\','#','space'] characters\n//the function below will get rid of those special characters if they exist\ndef SpecialCharacterCheck(process){\n\t//special characters not allowed in ActiveDiscovery\n\tdef specialCharacters = ~/\\=|\\:|\\\\|\\#|\\s/\n\n\t//replace the special character by nothing & return the 'new' process name\n\tprocess=process.replaceAll(specialCharacters, '')\n\t//println(process); //DEBUG\n\n\treturn process\n}"
    },
    "filters" : [ {
      "attribute" : "##WILDVALUE##",
      "operation" : "RegexNotMatch",
      "value" : "_Total|Idle",
      "comment" : "Excluding processes generally"
    } ]
  },
  "dataPoints" : [ {
    "id" : 17705,
    "dataSourceId" : 13504265,
    "name" : "HandleCount",
    "description" : "Total number of handles the process has open. This number is the sum of the handles currently open by each thread in the process.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.HandleCount",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17706,
    "dataSourceId" : 13504265,
    "name" : "IODataBytesPerSec",
    "description" : "Rate at which the process is reading and writing bytes in I/O operations. This property counts all I/O activity generated by the process to include file, network, and device I/Os.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.IODataBytesPerSec",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17707,
    "dataSourceId" : 13504265,
    "name" : "ProcessCPUPercent",
    "description" : "Percent of CPU cycles. Value exceeding 100% means the process consumes resources of more than one CPU or core.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "expression",
    "postProcessorParam" : "PercentProcessorTime/100000",
    "rawDataFieldName" : "",
    "maxValue" : "",
    "minValue" : "",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "The process ##INSTANCE## ##DSIDESCRIPTION## on Windows host ##HOST## is taking up ##VALUE##% of CPU cycles, placing the processes into ##LEVEL## state.\n\nValues exceeding 100% means the process consumes resources of more than one CPU or core.\n\nThis started at ##START##, -- or ##DURATION## ago.",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17708,
    "dataSourceId" : 13504265,
    "name" : "PercentProcessorTime",
    "description" : "Percentage of elapsed time that all of the threads of this process used the processor to execute instructions.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.PercentProcessorTime",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17709,
    "dataSourceId" : 13504265,
    "name" : "ProcessID",
    "description" : "Used to detect if a process is running.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.ProcessID",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "The process ##INSTANCE## ##DSIDESCRIPTION## on Windows host ##HOST## has stopped and is no longer collecting data, placing the processes into ##LEVEL## state.\n\nThe process has not been detected since ##START##, -- or ##DURATION## ago. .",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17710,
    "dataSourceId" : 13504265,
    "name" : "ThreadCount",
    "description" : "Number of threads currently active in this process.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.ThreadCount",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "",
    "enableAnomalyAlertSuppression" : ""
  }, {
    "id" : 17711,
    "dataSourceId" : 13504265,
    "name" : "WorkingSet",
    "description" : "Maximum number of bytes in the working set of this process at any point in time. The working set is the set of memory pages touched recently by the threads in the process.",
    "alertTransitionInterval" : 5,
    "alertClearTransitionInterval" : 0,
    "type" : 2,
    "dataType" : 7,
    "maxDigits" : 4,
    "postProcessorMethod" : "namevalue",
    "postProcessorParam" : "##WILDVALUE##.WorkingSet",
    "rawDataFieldName" : "output",
    "maxValue" : "",
    "minValue" : "0",
    "userParam1" : "",
    "userParam2" : "",
    "userParam3" : "",
    "alertForNoData" : 1,
    "alertExpr" : "",
    "alertExprNote" : "",
    "alertSubject" : "",
    "alertBody" : "",
    "enableAnomalyAlertSuppression" : ""
  } ],
  "enableEriDiscovery" : false,
  "eriDiscoveryInterval" : -1,
  "eriDiscoveryConfig" : null
}